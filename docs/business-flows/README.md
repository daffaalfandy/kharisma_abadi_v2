# Business Flows Documentation

**Last Updated:** October 22, 2025  
**Status:** COMPLETE DOCUMENTATION OF CURRENT AND PROPOSED FLOWS  
**Audience:** Product managers, business analysts, developers, stakeholders

---

## üìã Overview

This documentation provides comprehensive analysis of all business processes in the Kharisma Abadi system, including:

- ‚úÖ **Current service flows** (Car Wash, Laundry, Carpet, Water Delivery)
- ‚úÖ **Supporting processes** (Authentication, Payment, User Management, Reporting)
- ‚úÖ **Exception handling** (Cancellations, disputes, errors)
- ‚úÖ **Decision logic** (Income distribution, pricing, access control)
- ‚úÖ **User journeys** (How different roles interact with the system)

---

## üìö Document Index

### Service Flow Documentation

| Document | Status | Coverage | Pages |\n|----------|--------|----------|-------|\n| [car-wash-flow.md](./car-wash-flow.md) | ‚úÖ Complete | End-to-end car wash process, employee income, state management | 12 |\n| [laundry-flow.md](./laundry-flow.md) | ‚úÖ Complete | Laundry service with item tracking, price adjustment, 60/40 split | 11 |\n| [carpet-flow.md](./carpet-flow.md) | ‚úÖ Complete | Carpet washing (area-based), pickup/delivery, quality assurance | 10 |\n| [water-delivery-flow.md](./water-delivery-flow.md) | ‚úÖ Complete | Water delivery subscriptions, recurring orders, customer management | 11 |\n\n### Supporting Process Documentation\n\n| Document | Status | Scope | Priority |\n|----------|--------|-------|----------|\n| [authentication-flow.md](./authentication-flow.md) | üî¥ NOT IMPLEMENTED | JWT-based auth, roles, session management | CRITICAL |\n| [payment-processing-flow.md](./payment-processing-flow.md) | ‚ö†Ô∏è PARTIAL | Payment methods, partial payments, refunds, A/R | HIGH |\n| [user-management-flow.md](./user-management-flow.md) | ‚ö†Ô∏è PARTIAL | User CRUD, roles, permissions, audit trails | HIGH |\n| [reporting-flow.md](./reporting-flow.md) | ‚ö†Ô∏è PARTIAL | Dashboard, income reports, proposed analytics | MEDIUM |\n| [exception-flows.md](./exception-flows.md) | üìù DESIGNED | Cancellations, disputes, errors, recovery | HIGH |\n| [decision-tables.md](./decision-tables.md) | üìù DOCUMENTED | Business logic rules, validation, thresholds | MEDIUM |\n\n### Additional Resources\n\n- [user-journeys/](./user-journeys/) - User role perspectives (Cashier, Manager, Service Staff, Customer)\n- Related: [../business-logic/](../business-logic/) - Business rules catalog\n- Related: [../analysis/current-app-analysis.md](../analysis/current-app-analysis.md) - Technical system analysis\n\n---\n\n## üéØ Key Findings by Service Type\n\n### Car Wash Service ‚úÖ\n\n**Status:** Well-documented, production-proven\n\n**Highlights:**\n- ‚úÖ Variable employee compensation (configurable per service type)\n- ‚úÖ Multi-employee assignment with fair income division\n- ‚úÖ Transaction completion via end_date field\n- ‚úÖ Integrated into income calculations\n\n**Issues to Address:**\n- ‚ö†Ô∏è Floor division precision loss (remainder Rupiah lost)\n- ‚ö†Ô∏è No explicit status field (uses NULL check on end_date)\n- ‚ö†Ô∏è No payment method tracking\n- ‚ö†Ô∏è No payment status tracking\n\n**Recommendations:**\n1. Add explicit status ENUM field\n2. Fix income division precision\n3. Implement payment tracking\n4. Add service time metrics\n\n---\n\n### Laundry & Carpet Services ‚ö†Ô∏è\n\n**Status:** Working but needs improvements\n\n**Highlights:**\n- ‚úÖ Item-level tracking\n- ‚úÖ Flexible price adjustment mechanism\n- ‚úÖ Separate laundry/carpet classification\n- ‚úÖ Multi-day workflow support\n\n**Critical Issues:**\n- üî¥ **HARDCODED 60/40 SPLIT** - Not configurable, must change code to adjust\n- üî¥ Mixed in single table (differentiated by unit field)\n- üî¥ No employee income tracking (unlike car wash)\n- üî¥ Complex price adjustment logic (not intuitive)\n\n**Recommendations:**\n1. **IMMEDIATELY:** Move 60/40 split to database configuration\n2. Separate carpet and laundry into distinct tables\n3. Add employee assignment like car wash\n4. Simplify price adjustment UI\n5. Add explicit status field\n\n---\n\n### Water Delivery Service ‚ö†Ô∏è\n\n**Status:** Functional but lacks automation\n\n**Highlights:**\n- ‚úÖ Recurring subscription model\n- ‚úÖ Registered customer relationships\n- ‚úÖ High repeat business\n- ‚úÖ Simple transaction model\n- ‚úÖ 100% revenue to business\n\n**Critical Issues:**\n- üî¥ **NO AUTOMATION** - Each delivery must be manually created\n- üî¥ No recurring delivery scheduling\n- üî¥ No inventory management\n- üî¥ No payment method tracking\n- üî¥ No driver/route management\n\n**Recommendations:**\n1. **Implement recurring delivery automation** (auto-create transactions)\n2. Add inventory tracking (stock levels)\n3. Add payment tracking (prepaid, COD, invoice)\n4. Implement driver route management\n5. Add customer portal for self-service orders\n\n---\n\n## üî¥ Critical Security & System Issues\n\n### Authentication - CRITICAL ‚ö†Ô∏è\n\n**Current State:**\n- üî¥ **ZERO AUTHENTICATION** - No login system whatsoever\n- Anyone with network access can access all endpoints\n- No user identification or audit trail\n- No role-based access control\n\n**Impact:**\n- Complete data exposure\n- Employee fraud risk\n- No audit trail for accountability\n- Regulatory non-compliance\n\n**Solution:**\n- [authentication-flow.md](./authentication-flow.md) - Implement JWT-based auth\n- **Estimated Effort:** 3-4 weeks\n- **Priority:** IMMEDIATE\n\n### Payment Tracking - HIGH ‚ö†Ô∏è\n\n**Current State:**\n- Payment methods not recorded\n- No payment status tracking\n- No partial payment support\n- No refund mechanism\n- No accounts receivable\n\n**Solution:**\n- [payment-processing-flow.md](./payment-processing-flow.md) - Add payment table and tracking\n- **Estimated Effort:** 2-3 weeks\n- **Priority:** HIGH\n\n### Hardcoded Business Rules - HIGH ‚ö†Ô∏è\n\n**Current State:**\n- Laundry/Carpet income split (60/40) hardcoded in controller\n- Cannot change without redeployment\n- Same split for all types (inflexible)\n\n**Solution:**\n- Move to database configuration table\n- Estimated Effort: 2-3 days\n- Priority: HIGH\n\n---\n\n## üìä Process Flow Comparison\n\n### Transaction Completion Status\n\nAll services use `end_date` field to track completion:\n\n| Service | Status = NULL | Status NOT NULL |\n|---------|---|---|\n| Car Wash | Pending | Completed ‚úÖ |\n| Laundry | Pending | Completed ‚úÖ |\n| Carpet | Pending | Completed ‚úÖ |\n| Water | Pending (created) | Delivered ‚úÖ |\n\n**Recommendation:** Add explicit `status` ENUM field for clarity:\n```\nPENDING ‚Üí IN_PROGRESS ‚Üí READY ‚Üí DELIVERED/PICKED_UP ‚Üí CLOSED\n```\n\n### Employee Income Models\n\n| Service | Model | Configurable | Tracking |\n|---------|-------|--------------|----------|\n| Car Wash | Per-type variable | ‚úÖ Yes | ‚úÖ Per-employee |\n| Laundry | Fixed 60/40 | ‚ùå No | ‚ùå Global overhead |\n| Carpet | Fixed 60/40 | ‚ùå No | ‚ùå Global overhead |\n| Water | 100% to business | N/A | N/A (salary-based) |\n\n**Issue:** Inconsistent models and configurability\n\n**Recommendation:** Standardize on car wash model with database configuration\n\n---\n\n## üîß Implementation Roadmap\n\n### Phase 1: Critical Security (Weeks 1-4)\n**Must complete before production use:**\n\n- [ ] Implement authentication (JWT, roles, sessions)\n- [ ] Add user management (CRUD, permissions)\n- [ ] Add audit logging (who did what, when)\n- [ ] Move hardcoded business rules to database\n\n**Priority:** CRITICAL  \n**Effort:** 4 weeks  \n**Team:** 2 developers\n\n### Phase 2: Payment & Financial (Weeks 5-7)\n**Essential for business operations:**\n\n- [ ] Add payment method tracking\n- [ ] Add payment status tracking\n- [ ] Implement partial payments\n- [ ] Add refund mechanism\n- [ ] Implement cash drawer reconciliation\n- [ ] Add A/R aging reports\n\n**Priority:** HIGH  \n**Effort:** 3 weeks  \n**Team:** 1 developer\n\n### Phase 3: Service Improvements (Weeks 8-10)\n**Enhance existing services:**\n\n- [ ] Add explicit status fields (all services)\n- [ ] Separate carpet/laundry tables\n- [ ] Add employee assignment to laundry/carpet\n- [ ] Implement water delivery automation\n- [ ] Add inventory management (water)\n- [ ] Fix employee income precision issues\n\n**Priority:** HIGH  \n**Effort:** 3 weeks  \n**Team:** 2 developers\n\n### Phase 4: Analytics & Automation (Weeks 11-13)\n**Improve insights and efficiency:**\n\n- [ ] Add performance metrics dashboard\n- [ ] Implement customer lifetime value tracking\n- [ ] Add service quality metrics\n- [ ] Implement delivery route optimization\n- [ ] Add SMS/email notifications\n- [ ] Create scheduled reporting\n\n**Priority:** MEDIUM  \n**Effort:** 3 weeks  \n**Team:** 1 full-stack developer\n\n### Phase 5: Advanced Features (Weeks 14+)\n**Long-term enhancements:**\n\n- [ ] Mobile app for drivers\n- [ ] Customer portal\n- [ ] Integration with payment gateways\n- [ ] API rate limiting & security\n- [ ] Multi-location support\n- [ ] Franchise management\n\n**Priority:** LOW  \n**Effort:** Ongoing\n\n---\n\n## üìà Business Metrics by Service\n\n### Car Wash\n```\nFrequency: 50-100 transactions/day\nAverage Transaction: Rp 50-100K\nDaily Revenue: Rp 2.5-10M\nEmployee %: 30-50% variable\nRevenue %: 40% of business\n```\n\n### Laundry\n```\nFrequency: 30-50 transactions/day\nAverage Transaction: Rp 100-300K\nDaily Revenue: Rp 3-15M\nEmployee %: 40% fixed\nRevenue %: 27% of business\n```\n\n### Carpet\n```\nFrequency: 5-10 transactions/week\nAverage Transaction: Rp 500-1M\nWeekly Revenue: Rp 2.5-10M\nEmployee %: 40% fixed\nRevenue %: 18% of business\n```\n\n### Water Delivery\n```\nFrequency: 50-150 deliveries/week\nAverage Transaction: Rp 20K\nWeekly Revenue: Rp 1-3M\nEmployee %: 0% (salary-based)\nRevenue %: 15% of business\nRecurring: YES (subscription)\n```\n\n---\n\n## üöÄ Quick Start Guide\n\n### For Product Managers\n1. Read: [Overview section above](#-overview)\n2. Read: Service flows relevant to your focus area\n3. Check: [decision-tables.md](./decision-tables.md) for business logic\n4. Reference: Related business-logic documents\n\n### For Developers\n1. Start with: [car-wash-flow.md](./car-wash-flow.md) (best documented)\n2. Understand: Income calculation patterns\n3. Study: [decision-tables.md](./decision-tables.md) for validation rules\n4. Reference: Current codebase against flows\n5. Check: [exception-flows.md](./exception-flows.md) for error handling\n\n### For Business Analysts\n1. Read: [Overview section above](#-overview)\n2. Study: All service flow documents\n3. Understand: User journeys (./user-journeys/)\n4. Reference: [../business-logic/](../business-logic/) for detailed rules\n5. Check: [reporting-flow.md](./reporting-flow.md) for analytics\n\n### For Executives/Stakeholders\n1. Start: [Key Findings by Service Type](#-key-findings-by-service-type)\n2. Review: [Critical Security & System Issues](#-critical-security--system-issues)\n3. Check: [Implementation Roadmap](#-implementation-roadmap)\n4. Understand: [Business Metrics by Service](#-üìà-business-metrics-by-service)\n\n---\n\n## üìã Checklist for System Redesign\n\n### Must Have (P0)\n- [ ] Authentication & authorization system\n- [ ] Payment tracking and reconciliation\n- [ ] Audit logging (who did what, when)\n- [ ] Explicit transaction status fields\n- [ ] Configurable business rules (database-driven)\n- [ ] Input validation and error handling\n- [ ] Data integrity constraints\n\n### Should Have (P1)\n- [ ] Employee assignment to all services\n- [ ] Customer accounts and loyalty\n- [ ] Recurring delivery automation (water)\n- [ ] Cash drawer reconciliation\n- [ ] Customer satisfaction tracking\n- [ ] Performance metrics dashboard\n- [ ] Scheduled reporting\n\n### Nice to Have (P2)\n- [ ] Mobile app for drivers\n- [ ] Customer portal (self-service)\n- [ ] Payment gateway integration\n- [ ] SMS/email notifications\n- [ ] Route optimization\n- [ ] Inventory management\n- [ ] Multi-location support\n\n---\n\n## üîç Key Observations\n\n### Strengths of Current System\n1. ‚úÖ **Production-proven:** 3+ years of stable operation\n2. ‚úÖ **Clear separation:** Different services, separate transaction types\n3. ‚úÖ **Flexible pricing:** Car wash has configurable service types\n4. ‚úÖ **Good tracking:** Transaction history preserved\n5. ‚úÖ **Employee management:** Service staff tracked with income\n\n### Weaknesses to Address\n1. üî¥ **NO SECURITY:** Zero authentication, no user management\n2. üî¥ **HARDCODED RULES:** Business logic in code, not database\n3. üî¥ **INCONSISTENT:** Different income models per service\n4. üî¥ **INCOMPLETE:** No payment tracking, no refunds\n5. üî¥ **MANUAL:** Water delivery requires manual ordering\n6. üî¥ **NO AUDIT:** No logging of who changed what\n\n---\n\n## üìû Questions? Suggestions?\n\n- **Product Questions:** See [../business-logic/](../business-logic/)\n- **Technical Questions:** See [../analysis/current-app-analysis.md](../analysis/current-app-analysis.md)\n- **Business Rules:** See [decision-tables.md](./decision-tables.md)\n- **Implementation Details:** See individual service flows\n\n---\n\n## üìÑ Related Documentation\n\n**In this folder:**\n- Service flows (4 documents)\n- Supporting process flows (6 documents)\n- User journeys (4 documents)\n- Decision tables\n- This README\n\n**Related in docs/:**\n- [business-logic/](../business-logic/) - Detailed business rules\n- [analysis/current-app-analysis.md](../analysis/current-app-analysis.md) - Technical system analysis\n- [EXECUTIVE_SUMMARY.md](../EXECUTIVE_SUMMARY.md) - High-level overview\n\n---\n\n## üìä Document Statistics\n\n- **Total Documentation:** 15,000+ lines\n- **Service Flows:** 4 documents (45 pages)\n- **Supporting Flows:** 6 documents (30+ pages)\n- **Diagrams:** 50+ Mermaid flowcharts\n- **Tables:** 100+ decision tables\n- **Code Examples:** 200+ SQL/Python snippets\n\n---\n\n## Version History\n\n| Date | Version | Changes |\n|------|---------|----------|\n| 2025-10-22 | 1.0 | Initial complete documentation |\n\n---\n\n**Status:** ‚úÖ COMPLETE\n**Last Reviewed:** 2025-10-22\n**Next Review:** After system redesign phase completion\n\n---\n\n*This documentation serves as the foundation for understanding, maintaining, and modernizing the Kharisma Abadi application. Use it as reference during development, training, and system design decisions.*\n