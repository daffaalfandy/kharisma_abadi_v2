# Decision Tables & Business Logic Rules

---

## 1. Employee Income Distribution Decision Table\n\n### Car Wash Service\n\n**Table: Determine Employee Income Based on Cut Type and Number of Employees**\n\n| Condition | Cut Type | Cut Amount | Employees | Total Cut | Per Employee | Business Income |\n|-----------|----------|------------|-----------|-----------|--------------|---------------|\n| **Scenario 1** | Fixed (1) | Rp 10,000 | 1 | Rp 10,000 | Rp 10,000 | Rp 40,000 |\n| **Scenario 2** | Fixed (1) | Rp 10,000 | 2 | Rp 10,000 | Rp 5,000 | Rp 40,000 |\n| **Scenario 3** | Fixed (1) | Rp 10,000 | 3 | Rp 10,000 | Rp 3,333 (lost Rp 1) | Rp 40,000 |\n| **Scenario 4** | Percent (2) | 30% | 1 | Rp 15,000 (30% × 50k) | Rp 15,000 | Rp 35,000 |\n| **Scenario 5** | Percent (2) | 30% | 2 | Rp 15,000 | Rp 7,500 | Rp 35,000 |\n| **Scenario 6** | Percent (2) | 50% | 1 | Rp 25,000 (50% × 50k) | Rp 25,000 | Rp 25,000 |\n\n**Decision Logic:**\n```\nIF cut_type = 1 (FIXED):\n    total_cut = cut_amount (fixed)\nELSE IF cut_type = 2 (PERCENT):\n    total_cut = final_price × (cut_amount / 100)\n\nper_employee = total_cut // num_employees  // Floor division\nbusiness_income = final_price - total_cut\n```\n\n---\n\n## 2. Laundry/Carpet Price Adjustment Decision Table\n\n**Table: How Price Adjustments are Distributed Across Items**\n\n| Scenario | Item 1 | Item 2 | Item 3 | Final Price | Adjustment | Result |\n|----------|--------|--------|--------|-------------|------------|---------|\n| **No adjustment** | Rp 21,000 | Rp 16,000 | - | Rp 37,000 | Rp 0 | Item 1: Rp 21,000 |\n| | | | | | | Item 2: Rp 16,000 |\n| **Extra charge** | Rp 21,000 | Rp 16,000 | - | Rp 40,000 | +Rp 3,000 | Item 1: Rp 24,000 |\n| | | | | | | Item 2: Rp 16,000 |\n| **Discount** | Rp 21,000 | Rp 16,000 | - | Rp 30,000 | -Rp 7,000 | Item 1: Rp 14,000 |\n| | | | | | | Item 2: Rp 16,000 |\n| **Large discount** | Rp 21,000 | Rp 16,000 | - | Rp 20,000 | -Rp 17,000 | Item 1: Rp 0 (zeroed) |\n| | | | | | | Item 2: Rp 12,000 (- Rp 4,000) |\n\n**Decision Logic:**\n```\nadjustment = final_price - sum(item_prices)\n\nIF adjustment > 0:  // Extra charge\n    item[0].price += adjustment  // Add all to first item\nELSE IF adjustment < 0:  // Discount\n    FOR EACH item:\n        reduction = MIN(ABS(adjustment), item.price)\n        item.price -= reduction\n        adjustment += reduction  // Reduce remaining discount\n        IF adjustment == 0: BREAK\n```\n\n---\n\n## 3. Service Type Classification Decision Table\n\n**Table: Classify Transaction as Laundry or Carpet**\n\n| Items | Units | Classification | Notes |\n|-------|-------|-----------------|-------|\n| 5 T-shirts | pcs | **Laundry** | All units are pcs |\n| 2 kg Kiloan | kg | **Laundry** | All units are kg |\n| 1 Carpet 4×3m | m² | **Carpet** | Has carpet unit |\n| 3 Shirts + 1 Carpet | pcs, m² | **Carpet** | Mixed - classified as carpet |\n| 2 Sarongs | m | **Carpet** | Unit is m (linear) |\n| 1 Bedsheet (3m²) | m² | **Carpet** | Unit is m² (area) |\n\n**Decision Logic:**\n```\nis_carpet = FALSE\nFOR EACH item:\n    IF item.unit IN ['m', 'm2', 'm²']:\n        is_carpet = TRUE\n        BREAK\n\nIF is_carpet:\n    classification = 'CARPET'\nELSE:\n    classification = 'LAUNDRY'\n```\n\n---\n\n## 4. Payment Status Decision Table\n\n**Table: Determine Payment Status Based on Amount Paid**\n\n| Amount Due | Amount Paid | Status | Next Action |\n|------------|-------------|--------|-------------|\n| Rp 100,000 | Rp 0 | UNPAID | Send payment reminder |\n| Rp 100,000 | Rp 50,000 | PARTIAL | Collect remaining Rp 50,000 |\n| Rp 100,000 | Rp 100,000 | PAID | Complete transaction |\n| Rp 100,000 | Rp 120,000 | PAID (over) | Issue Rp 20,000 refund |\n| Rp 100,000 | -Rp 50,000 | REFUND | Customer refunded Rp 50,000 |\n\n**Decision Logic:**\n```\nIF amount_paid == 0:\n    status = 'UNPAID'\nELSE IF amount_paid < amount_due:\n    status = 'PARTIAL'\nELSE IF amount_paid == amount_due:\n    status = 'PAID'\nELSE IF amount_paid > amount_due:\n    status = 'PAID'\n    change = amount_paid - amount_due\nELSE IF amount_paid < 0:\n    status = 'REFUND'\n```\n\n---\n\n## 5. Water Delivery Payment Terms Decision Table\n\n**Table: Determine Payment Method and Tracking**\n\n| Customer Type | Payment Method | Payment Timing | Tracking | Follow-up |\n|---------------|---|---|---|---|\n| Registered (Prepaid) | Cash/Transfer | Before delivery | Immediate | None |\n| Registered (COD) | Cash | At delivery | Driver collects | None |\n| Registered (Invoice) | Transfer | Month-end | Monthly invoice | Due in 30 days |\n| Walk-in (COD) | Cash | At delivery | Driver collects | None |\n| Corporate (Invoice) | Transfer | Monthly | Monthly invoice | Due in 15 days (net 15) |\n| Corporate (Prepaid) | Transfer | Before month | Monthly advance | Auto-renew |\n\n---\n\n## 6. Refund Eligibility Decision Table\n\n**Table: Determine If Refund Should Be Approved**\n\n| Reason | Service Status | Amount Refund | Approval Level | Timeframe |\n|--------|---|---|---|---|\n| Order cancelled | Not started | 100% | Cashier | Immediate |\n| Order cancelled | In progress | 50% | Cashier | Immediate |\n| Order cancelled | Completed | 0% | Denied | - |\n| Poor quality (minor) | Completed | 0% + Rework | Cashier | Immediate |\n| Poor quality (major) | Completed | 50% | Manager | Within 24h |\n| Poor quality (critical) | Completed | 100% | Manager | Within 24h |\n| Duplicate transaction | Created | Full | Admin | Immediate |\n| Overcharge (error) | Completed | Difference | Cashier | Immediate |\n| Customer dissatisfaction | Completed | Negotiate | Manager | Within 48h |\n\n---\n\n## 7. Discount Authorization Decision Table\n\n**Table: Determine Who Can Approve Discounts**\n\n| Discount Amount | Type | Authority | Requires Approval | Document |\n|---|---|---|---|---|\n| < Rp 10,000 | Rounding | Cashier | No | Receipt note |\n| Rp 10,000 - Rp 50,000 | Volume | Cashier | No | Manual entry |\n| Rp 50,000 - Rp 200,000 | Loyalty | Manager | Yes | Manager signature |\n| Rp 200,000 - Rp 500,000 | Promotion | Manager | Yes | Approval code |\n| > Rp 500,000 | Special | Owner | Yes | Owner authorization |\n\n---\n\n## 8. Employee Income Hardcoding Decision Table\n\n**Current Issues:**\n\n| Service | Car Wash | Laundry | Carpet | Water |\n|---------|----------|---------|--------|-------|\n| **Income Model** | Variable (per-type) | Fixed 60/40 | Fixed 60/40 | Fixed 100% |\n| **Where Hardcoded** | car_wash_type table | dashboard_controller.py | dashboard_controller.py | Not applicable |\n| **Configurable?** | ✅ Yes (per type) | ❌ No | ❌ No | ✅ N/A |\n| **Recommendation** | Keep, improve UI | Move to database | Move to database | N/A |\n\n**Hardcoded Locations:**\n```\ndashboard_controller.py:\n- Line 66:  laundry_income = total * 0.40  // Wrong, should be 0.40\n- Line 72:  laundry_net = total * 0.60\n- Line 380: Same hardcoded split\n- Line 523: Same hardcoded split\n```\n\n---\n\n## 9. Email/SMS Notification Decision Table\n\n**Table: When to Send Notifications (Proposed)**\n\n| Event | Customer | Employee | Manager | Message | Timing |\n|-------|----------|----------|---------|---------|--------|\n| Order confirmed | ✅ SMS | ❌ | ❌ | Order #123 confirmed, ready in 30 min | Immediate |\n| Service done | ✅ SMS | ❌ | ❌ | Your service is ready for pickup | Immediate |\n| Payment reminder | ✅ Email | ❌ | ❌ | Invoice due in 5 days | 5 days before |\n| Payment overdue | ✅ SMS+Email | ❌ | ✅ Email | Invoice overdue, contact for payment | Daily |\n| Daily summary | ❌ | ❌ | ✅ Email | Today: Rp 2.7M, 45 TX, 12 staff | 5:30 PM |\n\n---\n\n## 10. User Access Control Decision Table\n\n**Table: What Each Role Can Do**\n\n| Action | ADMIN | MANAGER | CASHIER | VIEWER |\n|--------|-------|---------|---------|--------|\n| Create transaction | ✅ | ✅ | ✅ | ❌ |\n| View transaction | ✅ | ✅ | ✅ | ✅ |\n| Edit transaction | ✅ | ✅ | ✅ | ❌ |\n| Delete transaction | ✅ | ✅ | ❌ | ❌ |\n| Approve refund > Rp50k | ✅ | ✅ | ❌ | ❌ |\n| Approve refund > Rp500k | ✅ | ❌ | ❌ | ❌ |\n| View reports | ✅ | ✅ | Limited | Limited |\n| View financial reports | ✅ | ✅ | ❌ | ❌ |\n| Manage staff | ✅ | ✅ | ❌ | ❌ |\n| Manage users | ✅ | ❌ | ❌ | ❌ |\n| View audit log | ✅ | Limited | ❌ | ❌ |\n| System configuration | ✅ | ❌ | ❌ | ❌ |\n\n---\n\n## 11. Data Validation Decision Table\n\n**Table: Input Validation Rules**\n\n| Field | Required | Min | Max | Format | Example |\n|-------|----------|-----|-----|--------|----------|\n| Name | ✅ | 2 | 128 | Text | \"Ahmad Suryanto\" |\n| Phone | ❌ | - | 18 | Digits | \"08123456789\" |\n| Email | ❌ | 5 | 128 | Email | \"user@example.com\" |\n| Price | ✅ | 1 | 999,999,999 | Integer | \"50000\" |\n| Quantity | ✅ | 1 | 10,000 | Integer | \"5\" |\n| Date | ✅ | - | - | YYYY-MM-DD | \"2025-10-22\" |\n| License Plate | ❌ | 5 | 12 | Alphanumeric | \"B 1234 XYZ\" |\n| Address | ✅ | 10 | 500 | Text | \"Jl. Merdeka No. 45...\" |\n\n---\n\n## Summary of Key Decisions\n\n1. **Employee Income:** Per-type configuration for car wash, hardcoded for laundry/carpet/water\n2. **Price Adjustment:** Extra → first item, Discount → sequential subtraction\n3. **Service Classification:** Any carpet unit → classify as carpet\n4. **Payment Status:** 0% = UNPAID, 0-99% = PARTIAL, 100%+ = PAID\n5. **Refunds:** Not started = 100%, In progress = 50%, Done = 0% (policy)\n6. **Access Control:** Role-based, threshold-based for financial approvals\n7. **Notifications:** Event-triggered (proposed), not yet implemented\n\n---\n\n**Priority:** MEDIUM (implement with system modernization)\n**Related:** business-logic-summary.md, validation-rules.md\n