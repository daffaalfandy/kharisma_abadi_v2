# Kharisma Abadi V2

Modern, maintainable rebuild of the Kharisma Abadi multi-service cashier system.

## ğŸ¢ About

Kharisma Abadi is a comprehensive multi-service business offering:
- ğŸš— **Car Wash Service** - Professional vehicle washing
- ğŸ‘• **Laundry Service** - Clothing and textile cleaning
- ğŸ§º **Carpet Washing Service** - Professional carpet and upholstery cleaning
- ğŸ’§ **Drinking Water Delivery Service** - Bottled water distribution

This is a complete rebuild focusing on **maintainability**, **scalability**, and modern development practices.

**Key Improvements:**
- Consolidated schema from legacy 10+ tables to unified design
- Zero data loss migration of 67,000+ production records
- Clean Architecture with clear separation of concerns
- Comprehensive testing (unit, integration, E2E)
- Production-ready security implementation
- Complete API and business logic documentation

## ğŸ“š Documentation

**Start Here:**
1. [REFERENCE.md](./REFERENCE.md) - Complete documentation index
2. [docs/planning/PRD.md](./docs/planning/PRD.md) - Product requirements
3. [docs/technical/TECHNICAL-SPEC.md](./docs/technical/TECHNICAL-SPEC.md) - Technical specifications

**Full Documentation Structure:**
- `docs/planning/` - Requirements, user stories, product backlog
- `docs/technical/` - Architecture decisions, API specifications
- `docs/business-logic/` - Business rules and validations
- `docs/business-flows/` - Process flows and state machines
- `docs/database/` - Database schema and migration procedures
- `docs/api/` - Complete API documentation
- `docs/architecture/` - System architecture diagrams

## ğŸ› ï¸ Technology Stack

**Backend:**
- Framework: Go 1.21+ with Fiber web framework
- Language: Go (compiled binary)
- Database: MariaDB 11 LTS
- ORM: GORM
- Authentication: JWT with refresh tokens
- Validation: Go validators

**Frontend:**
- Framework: Next.js 14+ (App Router)
- Language: TypeScript 5+
- UI Library: shadcn/ui + Tailwind CSS
- State Management: Zustand + TanStack Query
- Form Handling: React Hook Form + Zod validation

**Infrastructure:**
- Containerization: Docker & Docker Compose
- Database: MariaDB 11
- Web Server: Nginx (reverse proxy)
- Development: Hot reload, debug mode

## ğŸš€ Quick Start

### Prerequisites

- **Docker Desktop** (includes Docker & Docker Compose)
- **Git** (version 2.30+)
- **Node.js 18+** (for frontend development without Docker)
- **Go 1.21+** (for backend development without Docker)

### Development Setup

1. **Clone the repository:**
   ```bash
   git clone <repository-url>
   cd kharisma-abadi-v2
   ```

2. **Copy environment files:**
   ```bash
   cp backend/.env.example backend/.env
   cp frontend/.env.local.example frontend/.env.local
   ```

3. **Edit environment files:**
   - `backend/.env` - Database credentials and secrets
   - `frontend/.env.local` - API endpoint configuration

4. **Start development environment:**
   ```bash
   # Using Docker Compose (recommended)
   make dev
   
   # Or manually
   docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
   ```

5. **Access the application:**
   - **Frontend:** http://localhost:3000
   - **Backend API:** http://localhost:8000
   - **API Documentation:** http://localhost:8000/docs
   - **Database:** localhost:3306 (MySQL client)

### Available Commands

```bash
# Development & Building
make dev              # Start complete development environment
make build            # Build all services (Docker images)
make clean            # Clean build artifacts and cache

# Testing
make test             # Run all tests (backend + frontend)
make test-backend     # Run backend unit tests
make test-frontend    # Run frontend unit tests
make test-e2e         # Run E2E tests

# Code Quality
make lint             # Run linters on all code
make format           # Auto-format code (Black, Prettier)
make type-check       # Run type checkers (mypy, TypeScript)

# Database
make migrate          # Run pending database migrations
make migrate-create   # Create new migration (prompts for message)
make db-seed          # Seed database with sample data
make db-backup        # Create database backup

# Utilities
make install          # Install all dependencies
make setup            # Initial setup (copy .env files)
make help             # Show all available commands
```

See [Makefile](./Makefile) for all available commands and details.

## ğŸ“ Project Structure

```
kharisma-abadi-v2/
â”œâ”€â”€ backend/                      # Go + Fiber API
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ handlers/            # HTTP request handlers
â”‚   â”‚   â”œâ”€â”€ services/            # Business logic layer
â”‚   â”‚   â”œâ”€â”€ repositories/        # Data access layer
â”‚   â”‚   â”œâ”€â”€ models/              # Domain entities
â”‚   â”‚   â”œâ”€â”€ middleware/          # HTTP middleware
â”‚   â”‚   â”œâ”€â”€ migrations/          # Database migrations
â”‚   â”‚   â””â”€â”€ main.go              # Application entry point
â”‚   â”œâ”€â”€ tests/                   # Backend tests
â”‚   â”œâ”€â”€ go.mod & go.sum          # Dependency management
â”‚   â”œâ”€â”€ Dockerfile               # Backend container
â”‚   â”œâ”€â”€ .env.example             # Environment template
â”‚   â””â”€â”€ README.md                # Backend documentation
â”‚
â”œâ”€â”€ frontend/                     # Next.js + TypeScript
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ components/          # React components
â”‚   â”‚   â”œâ”€â”€ services/            # API client services
â”‚   â”‚   â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ stores/              # Zustand state
â”‚   â”‚   â”œâ”€â”€ types/               # TypeScript types
â”‚   â”‚   â””â”€â”€ utils/               # Utility functions
â”‚   â”œâ”€â”€ public/                  # Static assets
â”‚   â”œâ”€â”€ __tests__/               # Frontend tests
â”‚   â”œâ”€â”€ package.json             # Dependencies
â”‚   â”œâ”€â”€ tsconfig.json            # TypeScript config
â”‚   â”œâ”€â”€ next.config.js           # Next.js config
â”‚   â”œâ”€â”€ Dockerfile               # Frontend container
â”‚   â”œâ”€â”€ .env.local.example       # Environment template
â”‚   â””â”€â”€ README.md                # Frontend documentation
â”‚
â”œâ”€â”€ docs/                        # Complete documentation
â”‚   â”œâ”€â”€ planning/                # Requirements & backlog
â”‚   â”œâ”€â”€ technical/               # Technical specs
â”‚   â”œâ”€â”€ business-logic/          # Business rules
â”‚   â”œâ”€â”€ business-flows/          # Process flows
â”‚   â”œâ”€â”€ database/                # Schema & migrations
â”‚   â”œâ”€â”€ api/                     # API documentation
â”‚   â”œâ”€â”€ architecture/            # System diagrams
â”‚   â””â”€â”€ analysis/                # Legacy analysis
â”‚
â”œâ”€â”€ scripts/                     # Utility scripts
â”‚   â”œâ”€â”€ setup-dev.sh             # Development setup
â”‚   â”œâ”€â”€ backup-db.sh             # Database backup
â”‚   â”œâ”€â”€ migrate-data.sh          # Data migration
â”‚   â””â”€â”€ deploy.sh                # Manual deployment
â”‚
â”œâ”€â”€ docker-compose.yml           # Development environment
â”œâ”€â”€ docker-compose.dev.yml       # Development overrides
â”œâ”€â”€ docker-compose.prod.yml      # Production configuration
â”œâ”€â”€ Makefile                     # Development commands
â”œâ”€â”€ .gitignore                   # Git ignore patterns
â”œâ”€â”€ .editorconfig                # Editor configuration
â”œâ”€â”€ README.md                    # This file
â”œâ”€â”€ CONTRIBUTING.md              # Contribution guidelines
â”œâ”€â”€ REFERENCE.md                 # Documentation reference
â””â”€â”€ LICENSE                      # License (MIT)
```

## ğŸ§ª Testing

### Backend Tests

```bash
cd backend
go test -v ./...                 # Run all tests with verbose output
go test -cover ./...            # Run tests with coverage
go test -race ./...             # Run tests with race detector
```

### Frontend Tests

```bash
cd frontend
npm test                         # Run unit tests in watch mode
npm run test:coverage           # Run tests with coverage report
npm run test:e2e                # Run Playwright E2E tests
```

### Test Coverage

Maintain >80% test coverage for critical paths:
- **Backend:** Business logic, API handlers, repositories
- **Frontend:** Components, hooks, utilities

## ğŸ” Security

The application implements comprehensive security measures:

- **Authentication:** JWT tokens with refresh token rotation
- **Authorization:** Role-based access control (RBAC)
  - Admin: Full system access
  - Manager: Orders, customers, reports
  - Cashier: Orders, customer info, payments
- **Data Protection:**
  - Passwords: Bcrypt hashing (cost 12)
  - Sensitive fields: AES-256 encryption
  - Backups: Encrypted storage
- **API Security:**
  - Input validation (Zod + Go validators)
  - SQL injection prevention (ORM parameterized queries)
  - XSS protection (output sanitization)
  - CSRF protection
- **Transport Security:**
  - HTTPS/TLS 1.3 in production
  - Secure HTTP headers
- **Audit Trail:**
  - All changes logged in audit_logs table
  - 7-year retention for compliance

See [docs/architecture/security-architecture.md](./docs/architecture/security-architecture.md) for details.

## ğŸ“ Development Workflow

### Feature Development

1. **Pick a task** from `docs/planning/product-backlog.md`
2. **Create feature branch:**
   ```bash
   git checkout -b feature/US-XXX-short-description
   ```
3. **Implement feature** following Clean Architecture patterns
4. **Write tests:** Unit + integration tests (>80% coverage)
5. **Code quality:**
   ```bash
   make lint      # Check for style issues
   make format    # Auto-format code
   ```
6. **Commit with conventional messages:**
   ```
   feat: Add car wash order creation (US-004)
   fix: Correct pricing calculation
   docs: Update API documentation
   test: Add payment service tests
   ```
7. **Create pull request** with test coverage
8. **Code review** and merge

### Deployment (Manual on Windows Client PC)

Manual deployment process for production:

1. **Build backend:**
   ```bash
   cd backend
   go build -o kharisma-api
   ```

2. **Build frontend:**
   ```bash
   cd frontend
   npm run build
   npm start  # Start Next.js server
   ```

3. **Database migration:**
   ```bash
   # Create backup first
   mysqldump -u root -p kharisma_db > backup.sql
   
   # Run migrations
   cd backend
   go run migrations/main.go
   ```

4. **Start application:**
   - Backend: `./kharisma-api`
   - Frontend: `npm start` (or use PM2/NSSM for Windows services)

See [docs/database/IMPLEMENTATION-GUIDE.md](./docs/database/IMPLEMENTATION-GUIDE.md) for detailed migration steps.

## ğŸ¤ Contributing

Please read [CONTRIBUTING.md](./CONTRIBUTING.md) for details on:
- Code style and standards
- Development process
- Testing requirements
- Pull request procedures

## ğŸ“Š Project Status

- âœ… Phase 1-4: Analysis, Planning, Architecture, Documentation **COMPLETE**
- âœ… Database migration plan and scripts **READY**
- âœ… Security architecture and implementation **DESIGNED**
- ğŸ”„ Phase 5: Backend development **IN PROGRESS**
- ğŸ”„ Phase 6: Frontend development **NEXT**
- ğŸ”„ Phase 7: Integration and testing **PLANNED**

## ğŸ“„ License

MIT License - See [LICENSE](./LICENSE) file for details

## ğŸ‘¥ Team

- **Project Lead:** [Your Name]
- **Backend Lead:** [Your Name]
- **Frontend Lead:** [Your Name]

## ğŸ“ Support

For issues, questions, or discussions:
- GitHub Issues: [repository-url]/issues
- Documentation: See [REFERENCE.md](./REFERENCE.md)
- Email: support@kharisma-abadi.local

---

**Status:** Ready for development phase

**Last Updated:** October 2025

**Next Steps:** Review `REFERENCE.md` and begin Phase 5 development
